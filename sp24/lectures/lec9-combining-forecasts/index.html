<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Lecture 9 - Combining Forecasts | Stat 157/260</title><meta name="generator" content="Jekyll v3.9.0" /><meta property="og:title" content="Lecture 9 - Combining Forecasts" /><meta name="author" content="Jean-Stanislas Denain" /><meta property="og:locale" content="en_US" /><meta name="description" content="Website for the UC Berkeley class STAT 165 / STAT 265." /><meta property="og:description" content="Website for the UC Berkeley class STAT 165 / STAT 265." /><link rel="canonical" href="http://forecastingclass.com/lectures/lec9-combining-forecasts/" /><meta property="og:url" content="http://forecastingclass.com/lectures/lec9-combining-forecasts/" /><meta property="og:site_name" content="Stat 157/260" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Lecture 9 - Combining Forecasts" /> <script type="application/ld+json"> {"url":"http://forecastingclass.com/lectures/lec9-combining-forecasts/","headline":"Lecture 9 - Combining Forecasts","author":{"@type":"Person","name":"Jean-Stanislas Denain"},"description":"Website for the UC Berkeley class STAT 165 / STAT 265.","@type":"WebPage","@context":"https://schema.org"}</script><body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="http://forecastingclass.com/" class="site-title lh-tight"> Stat 157/260 </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="http://forecastingclass.com/" class="nav-list-link">About</a><li class="nav-list-item"><a href="http://forecastingclass.com/calendar/" class="nav-list-link">Calendar</a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Stat 157/260" aria-label="Search Stat 157/260" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div></div><div id="main-content-wrap" class="main-content-wrap"><div id="main-content" class="main-content" role="main"> <script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.3/MathJax.js?config=TeX-MML-AM_CHTML"> MathJax.Hub.Config({ tex2jax: { inlineMath: [["$", "$"], ["\\(", "\\)"]], processEscapes: true } }); </script><h1 id="lecture-9-combining-forecasts"> <a href="#lecture-9-combining-forecasts" class="anchor-heading" aria-labelledby="lecture-9-combining-forecasts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Lecture 9: Combining Forecasts</h1><p>Often there are multiple ways to forecast the same thing, and we'd like a way of combining the forecasts together. For instance, consider the following question:</p><blockquote><p>Will <em>Will</em> be among the top 3 most sold nonfiction books on Amazon for the week of November 21?</p></blockquote><p><em>(This was posed to the course staff at the beginning of that week.)</em></p><p><img src="https://bounded-regret.ghost.io/content/images/2021/12/amazon_will_graphic.png" alt="amazon_will_graphic" /></p><p>I approached this problem using <a href="https://bounded-regret.ghost.io/base-rates-and-reference-classes/">reference class forecasting</a>, but there wasn't any single very good reference class. Specifically:</p><ul><li>I built up a <a href="https://docs.google.com/spreadsheets/d/1ZoI3C3mMAhf1S2DP2DKrNgt_8dfFySGyjlhfsVpipRU/edit#gid=0">dataset</a> of the past 6 weeks by manually copying information from the website.<li><em>Will</em> had been #1 last week and #7 two weeks prior (and not released before that).<li><strong>1 out of 3</strong> books in the top 3 remained there the following week (15 data points total).<li><strong>1 out of 5</strong> books in the top 1 were in the top 3 the following week (5 data points total).<li>Of books that were top 3 last week and top 8 the previous week, <strong>1 out of 4</strong> stayed in the top 3 (4 points total).<li>Of books that were top 1 last week and top 8 the previous week, <strong>1 out of 2</strong> stayed in the top 3 (2 points total).</ul><p>The problem is that:</p><ul><li>None of these reference classes have many data points.<li>The class with the most data points (“top 3 last week”) is the one that's least analogous to <em>Will</em>.</ul><p>One way out of this is to combine <em>all</em> the reference classes together in a weighted average. This is called <strong>ensembling</strong>. I'll start with a rough intuitive way of doing this and then give a more principled way (as with most things in forecasting, the best approach is to practice the principled way until it informs your intuition, then mostly go with intuitive numbers).</p><p><strong>Rough intuitive approach.</strong> Let's give each data source a score out of 10, based on how “good” it seems (a combination of the total number of data points and how analogous it is to <em>Will</em>).</p><ul><li>Top 3: I give this 6 out of 10. There's a lot of data points but it's only somewhat analogous.<li>Top 1: I give this 3.5 out of 10. More analogous, but few enough data points to have lots of noise.<li>Top 3 + top 8: I give this 3 out of 10. Similar to top 1 but one fewer data point.<li>Top 1 + top 8: 2 out of 10. Most analogous but no data.</ul><p>Then we combine as a weighted average: $\frac{6 \cdot (1/3) + 4 \cdot (1/5) + 3.5 \cdot (1/4) + 2 \cdot (1/2)}{6 + 4 + 3.5 + 2} = 0.30$.</p><p><strong>More principled approach.</strong> The intuitive approach is reasonable, but as written it neglects some obvious information: for instance, the fact that the “top 3” reference class should probably provide a lower bound (since <em>Will</em> was top 1), so we should forecast at least $5/15 = 0.33$ (instead of $0.30$ as above).</p><p>We can handle this by more explicitly modeling each of the 4 estimates as “noisy” versions of the true probability. Specifically:</p><ul><li>Let $\pi$ be the “true” probability that <em>Will</em> is top 3 next week.<li>For each reference class $i$, let $\pi_i$ denote the probability for that reference class (that is, the fraction of positives we would see if we had an infinite number of samples).<li>Finally, let $X_i$ be the observes number of positive samples and $N_i$ the total number of samples for the reference class. So for instance $X_1 = 5$, $N_1 = 15$, and $X_2 = 1$, $N_2 = 5$.</ul><p>We will think of each $\pi_i$ as a noisy version of $\pi$, and $X_i$ as a noisy version of $\pi_i$:</p><p align="center"> <img src="https://bounded-regret.ghost.io/content/images/2021/12/ensemble_model-2.png" /></p><p>For instance, if $\pi$ is the probability for <em>Will</em>, I might think the probability $\pi_1$ for a generic top 3 book is somewhere in the range $[\pi-0.2, \pi]$. To model this, I'll treat $\pi_1$ as a <a href="https://bounded-regret.ghost.io/common-probability-distributions/">Gaussian</a> with mean $\pi - 0.1$ and variance $0.1^2$.</p><p>In general, for each reference class $i$ we might think it has a bias $\Delta_i$ relative to $\pi$, and uncertainty $\sigma_i$, modeling $\pi_i$ as Gaussian with mean $\pi + \Delta_i$ and variance $\sigma_i^2$. Here's a table of my intuitions for $\Delta_i$ and $\sigma_i$:</p><div class="table-wrapper"><table><thead><tr><th>#<th>Ref. Class<th>$\Delta_i$<th>$\sigma_i$<tbody><tr><td>1<td>Top 3<td>-0.1<td>0.1<tr><td>2<td>Top 1<td>0<td>0.1<tr><td>3<td>Top 3 + top 8<td>0<td>0.1<tr><td>4<td>Top 1 + top 8<td>0<td>0.07</table></div><p>(<em>Brief explanation:</em> I intuitively thought “top 1” and “top 3 + top 8” were roughly equally good reference classes for <em>Will</em>, while “top 1 + top 8” was a bit better, so I gave the last one lower $\sigma_i$.)</p><p><strong>Going from $\pi_i$ to $\pi$.</strong> If we knew $\pi_1, \ldots, \pi_4$, then it turns out that the <a href="https://en.wikipedia.org/wiki/Maximum_likelihood_estimation">maximum likelihood estimate</a> for $\pi$ is</p><p align="center"> $\frac{(\pi_1 - \Delta_1) / \sigma_1^2 + (\pi_2 - \Delta_2) / \sigma_2^2 + (\pi_3 - \Delta_3) / \sigma_3^2 + (\pi_4 - \Delta_4) / \sigma_4^2}{1/\sigma_1^2 + 1/\sigma_2^2 + 1/\sigma_3^2 + 1/\sigma_4^2}$.</p><p>In other words, we first correct each $\pi_i$ for its bias, then take a weighted average, weighted by the inverse of the variance. This recovers the weighting idea from the rough intuitive approach. The main advantage is that it gives us a more principled way to think about the weights $1/\sigma_i^2$.</p><p><strong>Incorporating sample noise.</strong> However, there are still some problems. First, we don't actually know $\pi_i$: only $X_i$ and $N_i$. We can approximate $\pi_i$ as $\hat{\pi}_i = X_i / N_i$, but we also need to adjust $\sigma_i$. For instance, the table above has $\sigma_4$ as the smallest, meaning we would rely on it most in our average, but that reference class only has $2$ data points.</p><p>Fortunately, there is a simple mathematical correction for the difference between $\hat{\pi}_i$ and $\pi_i$. It relies on the assumption that $\hat{\pi}_i$ is an average of independent random variables (the different members of the reference class) and so can be well-approximated by a Gaussian distribution. A <a href="https://en.wikipedia.org/wiki/Bessel%27s_correction">standard estimate</a> of the variance of this Gaussian is $\frac{\hat{\pi}_i(1-\hat{\pi}_i)}{N_i-1}$, so we can replace the old $\sigma_i$ with the corrected values</p><p align="center"> $\overline{\sigma}\_i^2 = \sigma_i^2 + \frac{\hat{\pi}\_i(1 - \hat{\pi}\_i)}{N_i - 1}$</p><p>The following table summarizes these calculations:</p><div class="table-wrapper"><table><thead><tr><th>#<th>Ref. Class<th>$\Delta_i$<th>$\sigma_i$<th>$X_i$<th>$N_i$<th>$\hat{\pi}_i$<th>$\overline{\sigma}_i^2$<tbody><tr><td>1<td>Top 3<td>-0.1<td>0.1<td>5<td>15<td>0.33<td>$0.1^2 + 0.016 = 0.026$<tr><td>2<td>Top 1<td>0<td>0.1<td>1<td>5<td>0.2<td>$0.1^2 + 0.04 = 0.05$<tr><td>3<td>Top 3 + top 8<td>0<td>0.1<td>1<td>4<td>0.25<td>$0.1^2 + 0.063 = 0.073$<tr><td>4<td>Top 1 + top 8<td>0<td>0.07<td>1<td>2<td>0.5<td>$0.07^2 + 0.25 = 0.255$</table></div><p>Weighting the $\pi_i - \Delta_i$ by $1/\overline{\sigma}_i^2$, we get an overall estimate of $0.34$, which makes more sense than the $0.30$ forecast from before.</p><p><strong>Combining the approaches.</strong> In practice, it's probably not worth exhaustively doing the math above to compute $\overline{\sigma}_i$. Instead, I would in fact pick the weights based on intuition, but keep in mind that they are based on two terms: one capturing how similar the reference class is to what we care about (after correcting for bias), and one capturing finite sample error, which decreases at a rate of roughly $1/N_i$.</p><p>There are two reasons that computing the weights intuitively, rather than mathematically, is usually better. The first is that the math above depends on independence assumptions that might not hold. For instance, since the “top 1” reference class is a subset of the “top 3” reference class, they are positively correlated, so I'd want to decrease the weight for “top 1” a bit since it's redundant information. After I did this, my intuitive forecast was $0.36$ rather than $0.34$.</p><p>Another important reason is that it's easy to get caught up in these calculations, when it's often better to instead look at the problem from additional angles. For instance, one of the other course staff realized that autobiographies often stay in the top 3 for a while, and that <em>Will</em> had so far been particularly well-received within this genre, so gave a probability significantly above 50% (and ended up being right).</p><h2 id="combining-external-forecasts"> <a href="#combining-external-forecasts" class="anchor-heading" aria-labelledby="combining-external-forecasts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Combining External Forecasts</h2><p>We used the ideas above to aggregate different reference classes, but we can apply the same strategy of averaging predictions whenever there are multiple ways of approaching a forecasting problem.</p><p>More interestingly, we can combine predictions of different <em>forecasters</em>. Let's say that Frances and I both make forecasts about something, but I know that so far she's had a somewhat better track record than me. Then I could probably do better than either of us by averaging our forecasts but giving hers a 3:1 weight relative to mine. (Or if she's done much better than me, 10:1; or 1:1 if we've done similarly.) You can also do this for larger teams and even for people you don't know, as long as you have a rough sense of how much to trust them.</p><p>In practice, this is how I form beliefs for most topics: I <a href="https://www.cold-takes.com/minimal-trust-investigations/">identify a set of experts who have a good track record</a>, and take a weighted average of their views. For a much smaller set of topics, I also develop my own deep “inside view”, although if I were making forecasts I would still average that view with other experts.</p><p>However, when practicing forecasting, you don't want to just defer to others' forecasts all the time, since then you won't improve your own forecasting skills. You want to practice <strong>both</strong> the skill of generating your own forecasts and weighing the forecasts of others. In addition, if you are on a team of forecasters, often the most successful method is the <a href="https://en.wikipedia.org/wiki/Delphi_method">Delphi method</a>, where forecasters first generate predictions individually, then discuss, then generate new predictions and take the average. You'll get to practice this a lot in the group discussions this semester to get a sense for it.</p><h2 id="summary"> <a href="#summary" class="anchor-heading" aria-labelledby="summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Summary</h2><p>Ensembling–the idea of taking weighted averages of forecasts–is a powerful tool for improving over any individual forecast. When assigning weights, you want to consider both the quality of the underlying data and how closely the forecast captures the situation at hand. However, obsessing too much about how to ensemble can also distract you from searching for new information that significantly alters your view—so it's usually best to perform as a lightweight “post-processing” step.</p></div></div><div class="search-overlay"></div></div>
